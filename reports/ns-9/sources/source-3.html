


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>: Coverage Report > HttpClientKt</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope: :<span class="separator">|</span>    <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">dev.suresh.http</a>
</div>

<h1>Coverage Summary for Class: HttpClientKt (dev.suresh.http)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">HttpClientKt</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (13/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (46/46)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package dev.suresh.http
&nbsp;
&nbsp;import dev.suresh.log
&nbsp;import io.github.oshai.kotlinlogging.KLogger
&nbsp;import io.ktor.client.*
&nbsp;import io.ktor.client.plugins.*
&nbsp;import io.ktor.client.plugins.compression.*
&nbsp;import io.ktor.client.plugins.contentnegotiation.*
&nbsp;import io.ktor.client.plugins.cookies.*
&nbsp;import io.ktor.client.plugins.logging.*
&nbsp;import io.ktor.client.plugins.resources.*
&nbsp;import io.ktor.http.*
&nbsp;import io.ktor.serialization.kotlinx.json.*
&nbsp;import io.ktor.util.*
&nbsp;import kotlinx.serialization.json.ClassDiscriminatorMode.POLYMORPHIC
&nbsp;import kotlinx.serialization.json.Json
&nbsp;
&nbsp;/** Common JSON instance for serde of JSON data. */
<b class="fc">&nbsp;val json by lazy {</b>
<b class="fc">&nbsp;  Json {</b>
<b class="fc">&nbsp;    prettyPrint = true</b>
<b class="fc">&nbsp;    isLenient = true</b>
<b class="fc">&nbsp;    ignoreUnknownKeys = true</b>
<b class="fc">&nbsp;    encodeDefaults = true</b>
<b class="fc">&nbsp;    explicitNulls = false</b>
<b class="fc">&nbsp;    decodeEnumsCaseInsensitive = true</b>
<b class="fc">&nbsp;    allowTrailingComma = true</b>
<b class="fc">&nbsp;    allowSpecialFloatingPointValues = true</b>
<b class="fc">&nbsp;    allowStructuredMapKeys = true</b>
<b class="fc">&nbsp;    allowComments = true</b>
<b class="fc">&nbsp;    classDiscriminatorMode = POLYMORPHIC</b>
&nbsp;  }
&nbsp;}
&nbsp;
&nbsp;/** Multiplatform HTTP client factory function. */
&nbsp;expect fun httpClient(
&nbsp;    name: String = &quot;Api Client&quot;,
&nbsp;    timeout: Timeout = Timeout.DEFAULT,
&nbsp;    retry: Retry = Retry.DEFAULT,
&nbsp;    httpLogger: KLogger = log,
&nbsp;    config: HttpClientConfig&lt;*&gt;.() -&gt; Unit = {
&nbsp;      install(Resources)
&nbsp;
&nbsp;      install(ContentNegotiation) { json(json) }
&nbsp;
&nbsp;      install(ContentEncoding) {
&nbsp;        deflate(1.0F)
&nbsp;        gzip(0.9F)
&nbsp;      }
&nbsp;
&nbsp;      install(HttpRequestRetry) {
&nbsp;        maxRetries = retry.attempts
&nbsp;        retryOnException(retryOnTimeout = true)
&nbsp;        retryOnServerErrors()
&nbsp;        exponentialDelay(maxDelayMs = retry.maxDelay.inWholeMilliseconds)
&nbsp;      }
&nbsp;
&nbsp;      install(HttpTimeout) {
&nbsp;        connectTimeoutMillis = timeout.connection.inWholeMilliseconds
&nbsp;        requestTimeoutMillis = timeout.read.inWholeMilliseconds
&nbsp;        socketTimeoutMillis = timeout.write.inWholeMilliseconds
&nbsp;      }
&nbsp;
&nbsp;      install(HttpCookies)
&nbsp;
&nbsp;      install(Logging) {
&nbsp;        level =
&nbsp;            when {
&nbsp;              httpLogger.isDebugEnabled() -&gt; LogLevel.ALL
&nbsp;              httpLogger.isLoggingOff() -&gt; LogLevel.NONE
&nbsp;              else -&gt; LogLevel.INFO
&nbsp;            }
&nbsp;
&nbsp;        logger =
&nbsp;            object : Logger {
&nbsp;              override fun log(message: String) {
&nbsp;                httpLogger.info { message }
&nbsp;              }
&nbsp;            }
&nbsp;        sanitizeHeader { header -&gt; header == HttpHeaders.Authorization }
&nbsp;      }
&nbsp;
&nbsp;      engine { pipelining = true }
&nbsp;
&nbsp;      followRedirects = true
&nbsp;
&nbsp;      install(UserAgent) { agent = &quot;$name-${BuildConfig.version}&quot; }
&nbsp;
&nbsp;      install(DefaultRequest) {
&nbsp;        headers.appendIfNameAndValueAbsent(
&nbsp;            HttpHeaders.ContentType, ContentType.Application.Json.toString())
&nbsp;      }
&nbsp;
&nbsp;      expectSuccess = true
&nbsp;
&nbsp;      HttpResponseValidator {
&nbsp;        handleResponseExceptionWithRequest { ex, req -&gt;
&nbsp;          val resException = ex as? ResponseException ?: return@handleResponseExceptionWithRequest
&nbsp;          val res = resException.response
&nbsp;          httpLogger.trace { &quot;Request failed: ${req.method.value} ${req.url} -&gt; ${res.status}&quot; }
&nbsp;        }
&nbsp;      }
&nbsp;    }
&nbsp;): HttpClient
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-11-04 23:15</div>
</div>
</body>
</html>
