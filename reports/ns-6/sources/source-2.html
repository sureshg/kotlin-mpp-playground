


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>kotlin-mpp-playground Coverage Report > WebappKt</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope: kotlin-mpp-playground<span class="separator">|</span>    <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">dev.suresh.routes</a>
</div>

<h1>Coverage Summary for Class: WebappKt (dev.suresh.routes)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">WebappKt</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/26)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/115)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1193)
  </span>
</td>
</tr>
  <tr>
    <td class="name">WebappKt$summary$1$11</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">WebappKt$webApp$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/25)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">WebappKt$webApp$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">WebappKt$webApp$2$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">WebappKt$webApp$2$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/23)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/28)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/123)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1283)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package dev.suresh.routes
&nbsp;
&nbsp;import com.sun.management.OperatingSystemMXBean
&nbsp;import dev.suresh.plugins.debug
&nbsp;import io.ktor.server.application.*
&nbsp;import io.ktor.server.http.content.*
&nbsp;import io.ktor.server.request.*
&nbsp;import io.ktor.server.response.*
&nbsp;import io.ktor.server.routing.*
&nbsp;import java.io.File
&nbsp;import java.lang.management.ManagementFactory
&nbsp;import java.net.InetAddress
&nbsp;import java.net.InetSocketAddress
&nbsp;import java.net.Socket
&nbsp;import java.net.StandardSocketOptions
&nbsp;import java.nio.charset.Charset
&nbsp;import java.security.KeyStore
&nbsp;import java.security.Security
&nbsp;import java.time.Duration
&nbsp;import java.time.LocalDateTime
&nbsp;import java.time.ZoneId
&nbsp;import java.util.*
&nbsp;import java.util.HexFormat
&nbsp;import javax.net.ssl.TrustManagerFactory
&nbsp;import javax.net.ssl.X509TrustManager
&nbsp;
&nbsp;fun Route.webApp() {
<b class="nc">&nbsp;  val webAppRoute = &quot;/app&quot;</b>
&nbsp;
<b class="nc">&nbsp;  get(&quot;/info&quot;) { call.respond(summary(call.debug)) }</b>
&nbsp;
<b class="nc">&nbsp;  staticResources(webAppRoute, &quot;webapp&quot;) {</b>
<b class="nc">&nbsp;    exclude { it.path.endsWith(&quot;.log&quot;) }</b>
<b class="nc">&nbsp;    default(&quot;index.html&quot;)</b>
<b class="nc">&nbsp;    modify { _, call -&gt;</b>
<b class="nc">&nbsp;      when (call.request.path()) {</b>
<b class="nc">&nbsp;        webAppRoute -&gt; call.respondRedirect(&quot;$webAppRoute/&quot;)</b>
&nbsp;      }
&nbsp;    }
&nbsp;  }
&nbsp;}
&nbsp;
<b class="nc">&nbsp;fun summary(debug: Boolean = false) = buildString {</b>
<b class="nc">&nbsp;  val rt = Runtime.getRuntime()</b>
<b class="nc">&nbsp;  val unit = 1024 * 1024L</b>
<b class="nc">&nbsp;  val heapSize = rt.totalMemory()</b>
<b class="nc">&nbsp;  val heapFreeSize = rt.freeMemory()</b>
<b class="nc">&nbsp;  val heapUsedSize = heapSize - heapFreeSize</b>
<b class="nc">&nbsp;  val heapMaxSize = rt.maxMemory()</b>
<b class="nc">&nbsp;  val osMxBean = ManagementFactory.getPlatformMXBean(OperatingSystemMXBean::class.java)</b>
<b class="nc">&nbsp;  val rtMxBean = ManagementFactory.getRuntimeMXBean()</b>
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ Time: ${LocalDateTime.now()}&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [JVM] JVM Version              : ${System.getProperty(&quot;java.version&quot;)}&quot;)</b>
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [SYS-OS]  Operating System     : ${System.getProperty(&quot;os.name&quot;)}&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [SYS-CPU] CPU Arch             : ${System.getProperty(&quot;os.arch&quot;)}&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [SYS-CPU] Available Processors : ${rt.availableProcessors()}&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [SYS-CPU] System CPU Usage     : ${osMxBean.cpuLoad}&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [JVM-CPU] JVM CPU Usage        : ${osMxBean.processCpuLoad}&quot;)</b>
<b class="nc">&nbsp;  appendLine(</b>
<b class="nc">&nbsp;      &quot;✧✧✧ [JVM-CPU] JVM CPU Time(Sec)    : ${Duration.ofNanos(osMxBean.processCpuTime).toSeconds()}&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [SYS-MEM] Total Memory                  : ${osMxBean.totalMemorySize / unit} MiB&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [SYS-MEM] Free  Memory                  : ${osMxBean.freeMemorySize / unit} MiB&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [JVM-MEM] Current Heap Size (Committed) : ${heapSize / unit} MiB&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [JVM-MEM] Current Free memory in Heap   : ${heapFreeSize/unit} MiB&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [JVM-MEM] Currently used memory         : ${heapUsedSize/unit} MiB&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ [JVM-MEM] Max Heap Size (-Xmx)          : ${heapMaxSize/unit} MiB&quot;)</b>
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ JVM Input Arguments ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  appendLine(rtMxBean.inputArguments)</b>
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ Processes ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val ps = ProcessHandle.allProcesses().sorted(ProcessHandle::compareTo).toList()</b>
<b class="nc">&nbsp;  if (debug) {</b>
<b class="nc">&nbsp;    ps.forEach { appendLine(&quot;${it.pid()} : ${it.info()}&quot;) }</b>
&nbsp;  } else {
<b class="nc">&nbsp;    appendLine(&quot;Found ${ps.size} processes.&quot;)</b>
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ Trust stores ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val caCerts =</b>
<b class="nc">&nbsp;      TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm()).run {</b>
<b class="nc">&nbsp;        init(null as KeyStore?)</b>
<b class="nc">&nbsp;        trustManagers.filterIsInstance&lt;X509TrustManager&gt;().flatMap { it.acceptedIssuers.toList() }</b>
&nbsp;      }
<b class="nc">&nbsp;  caCerts.forEach { appendLine(it.issuerX500Principal) }</b>
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ Dns Resolution ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val dns = InetAddress.getAllByName(&quot;google.com&quot;).toList()</b>
<b class="nc">&nbsp;  dns.forEach { appendLine(it) }</b>
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ TimeZones ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val tz = ZoneId.getAvailableZoneIds()</b>
<b class="nc">&nbsp;  if (debug) {</b>
<b class="nc">&nbsp;    tz.forEach { appendLine(it) }</b>
&nbsp;  } else {
<b class="nc">&nbsp;    appendLine(&quot;Found ${tz.size} timezones.&quot;)</b>
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ Charsets ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val cs = Charset.availableCharsets()</b>
<b class="nc">&nbsp;  if (debug) {</b>
<b class="nc">&nbsp;    cs.forEach { (name, charset) -&gt; appendLine(&quot;$name: $charset&quot;) }</b>
&nbsp;  } else {
<b class="nc">&nbsp;    appendLine(&quot;Found ${cs.size} charsets.&quot;)</b>
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ System Locales ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val locales = Locale.getAvailableLocales()</b>
<b class="nc">&nbsp;  if (debug) {</b>
<b class="nc">&nbsp;    locales.forEach { appendLine(it) }</b>
&nbsp;  } else {
<b class="nc">&nbsp;    appendLine(&quot;Found ${locales.size} locales.&quot;)</b>
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ System Countries ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val countries = Locale.getISOCountries()</b>
<b class="nc">&nbsp;  if (debug) {</b>
<b class="nc">&nbsp;    countries.forEach { appendLine(it) }</b>
&nbsp;  } else {
<b class="nc">&nbsp;    appendLine(&quot;Found ${countries.size} countries.&quot;)</b>
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ System Currencies ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val currencies = Currency.getAvailableCurrencies()</b>
<b class="nc">&nbsp;  if (debug) {</b>
<b class="nc">&nbsp;    currencies.forEach { appendLine(it) }</b>
&nbsp;  } else {
<b class="nc">&nbsp;    appendLine(&quot;Found ${currencies.size} currencies.&quot;)</b>
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ System Languages ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val languages = Locale.getISOLanguages()</b>
<b class="nc">&nbsp;  if (debug) {</b>
<b class="nc">&nbsp;    languages.forEach { appendLine(it) }</b>
&nbsp;  } else {
<b class="nc">&nbsp;    appendLine(&quot;Found ${languages.size} languages.&quot;)</b>
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ Env Variables ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val env = System.getenv()</b>
<b class="nc">&nbsp;  env.forEach { (k: String, v: String) -&gt; appendLine(&quot;$k : $v&quot;) }</b>
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ System Properties ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val props = System.getProperties()</b>
<b class="nc">&nbsp;  props.forEach { k: Any, v: Any -&gt; appendLine(&quot;$k : $v&quot;) }</b>
&nbsp;
<b class="nc">&nbsp;  val fmt = HexFormat.ofDelimiter(&quot;, &quot;).withUpperCase().withPrefix(&quot;0x&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ I ❤️ Kotlin = ${fmt.formatHex(&quot;I ❤️ Kotlin&quot;.encodeToByteArray())}&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ LineSeparator  = ${fmt.formatHex(System.lineSeparator().encodeToByteArray())}&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ File PathSeparator = ${fmt.formatHex(File.pathSeparator.encodeToByteArray())}&quot;)</b>
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ File Separator = ${fmt.formatHex(File.separator.encodeToByteArray())}&quot;)</b>
&nbsp;
<b class="nc">&nbsp;  appendLine(&quot;✧✧✧ Additional info in exception ✧✧✧&quot;)</b>
<b class="nc">&nbsp;  val ex =</b>
<b class="nc">&nbsp;      runCatching {</b>
<b class="nc">&nbsp;            Security.setProperty(&quot;jdk.includeInExceptions&quot;, &quot;hostInfo,jar&quot;)</b>
<b class="nc">&nbsp;            Socket().use { s -&gt;</b>
<b class="nc">&nbsp;              s.setOption(StandardSocketOptions.SO_REUSEADDR, true)</b>
<b class="nc">&nbsp;              s.setOption(StandardSocketOptions.SO_REUSEPORT, true)</b>
<b class="nc">&nbsp;              s.setOption(StandardSocketOptions.SO_KEEPALIVE, true)</b>
&nbsp;              // Disable the Nagle algorithm
&nbsp;              // s.setOption(StandardSocketOptions.TCP_NODELAY, true)
&nbsp;              // s.setOption(StandardSocketOptions.SO_RCVBUF, 4096)
<b class="nc">&nbsp;              s.soTimeout = 100</b>
<b class="nc">&nbsp;              s.connect(InetSocketAddress(&quot;localhost&quot;, 12345), 100)</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;          }</b>
<b class="nc">&nbsp;          .exceptionOrNull()</b>
<b class="nc">&nbsp;  appendLine(ex?.message)</b>
<b class="nc">&nbsp;  println(ex?.message)</b>
<b class="nc">&nbsp;  check(ex?.message?.contains(&quot;localhost/127.0.0.1:12345&quot;) == true)</b>
&nbsp;
<b class="nc">&nbsp;  appendLine(</b>
&nbsp;      &quot;&quot;&quot;
&nbsp;      +---------Summary-------+
<b class="nc">&nbsp;      | Processes      : ${ps.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | Dns Addresses  : ${dns.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | Trust Stores   : ${caCerts.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | TimeZones      : ${tz.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | CharSets       : ${cs.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | Locales        : ${locales.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | Countries      : ${countries.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | Languages      : ${languages.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | Currencies     : ${currencies.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | Env Vars       : ${env.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | Sys Props      : ${props.size.toString().padEnd(5)}|</b>
<b class="nc">&nbsp;      | Virtual Thread : ${Thread.currentThread().isVirtual} |</b>
&nbsp;      +-----------------------+
&nbsp;     &quot;&quot;&quot;
<b class="nc">&nbsp;          .trimIndent(),</b>
&nbsp;  )
<b class="nc">&nbsp;}</b>
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-10-26 00:22</div>
</div>
</body>
</html>
